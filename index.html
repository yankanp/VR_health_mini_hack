<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Quest Basic Locomotion + Interaction (Fixed)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ✅ Latest A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- ✅ aframe-extras v7.2.0 (compatible with A-Frame 1.5) -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
  </head>

  <body>
    <a-scene background="color: #101418" webxr="optionalFeatures: local-floor">
      <!-- Lights -->
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 1" position="1 3 2"></a-entity>

      <!-- Ground -->
      <a-plane rotation="-90 0 0" width="20" height="20" color="#333"></a-plane>

      <!-- Player rig with smooth joystick locomotion -->
      <a-entity id="rig" movement-controls="speed: 0.25" position="0 1.6 0">
        <a-entity camera look-controls position="0 0 0"></a-entity>

        <!-- Right controller for grab -->
        <a-entity
          id="rightHand"
          oculus-touch-controls="hand: right"
          raycaster="objects: .interactable"
          line="color: yellow; opacity: 0.8"
          cursor
          grabber
        ></a-entity>

        <!-- Left controller -->
        <a-entity id="leftHand" oculus-touch-controls="hand: left"></a-entity>
      </a-entity>

      <!-- Load model -->
      <a-assets>
        <a-asset-item id="muscle" src="models/muscle.glb"></a-asset-item>
      </a-assets>

      <!-- The model -->
      <a-entity
        id="model"
        class="interactable"
        gltf-model="#muscle"
        position="0 3 -1.5"
        scale="100 100 100"
      ></a-entity>

      <!-- Basic grab component -->
      <script>
        AFRAME.registerComponent('grabber', {
          init: function () {
            const el = this.el;
            let grabbed = null;

            el.addEventListener('triggerdown', () => {
              const hit = el.components.raycaster.intersectedEls[0];
              if (hit) {
                grabbed = hit;
                el.object3D.attach(hit.object3D);
              }
            });

            el.addEventListener('triggerup', () => {
              if (grabbed) {
                document.querySelector('a-scene').object3D.attach(grabbed.object3D);
                grabbed = null;
              }
            });
          },
        });
      </script>
    </a-scene>
  </body>
</html>
